<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyTimetable - Admin Control Panel</title>
<link rel="icon" type="image/png" href="https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
min-height: 100vh;
color: white;
overflow-x: hidden;
}

.container {
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
}

.aurora-bg {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
overflow: hidden;
}

.aurora-bg::before,
.aurora-bg::after {
content: '';
position: absolute;
width: 200%;
height: 200%;
animation: aurora 20s ease-in-out infinite;
}

.aurora-bg::before {
background: radial-gradient(circle at 20% 50%, rgba(255, 0, 100, 0.2) 0%, transparent 50%),
radial-gradient(circle at 80% 80%, rgba(255, 0, 200, 0.2) 0%, transparent 50%);
animation-delay: -10s;
}

.aurora-bg::after {
background: radial-gradient(circle at 60% 70%, rgba(100, 0, 255, 0.2) 0%, transparent 50%),
radial-gradient(circle at 40% 40%, rgba(0, 100, 255, 0.2) 0%, transparent 50%);
}

@keyframes aurora {
0%, 100% { transform: translate(0, 0) rotate(0deg); }
33% { transform: translate(-5%, -5%) rotate(120deg); }
66% { transform: translate(5%, 5%) rotate(240deg); }
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-10px); }
75% { transform: translateX(10px); }
}

@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.05); }
}

.glass-card {
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(20px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.1);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
padding: 40px;
width: 100%;
animation: fadeIn 0.5s ease;
}

.admin-header {
text-align: center;
margin-bottom: 30px;
}

.admin-header h1 {
font-size: 32px;
margin-bottom: 5px;
background: linear-gradient(135deg, #ff0080, #ff8c00, #40e0d0);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
font-weight: 700;
}

.admin-header p {
color: rgba(255, 255, 255, 0.6);
font-size: 14px;
}

.input-field {
width: 100%;
padding: 15px;
margin-bottom: 15px;
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.2);
background: rgba(255, 255, 255, 0.1);
color: white;
font-size: 16px;
outline: none;
transition: all 0.3s;
}

.input-field::placeholder {
color: rgba(255, 255, 255, 0.5);
}

.input-field:focus {
border-color: #ff8c00;
background: rgba(255, 255, 255, 0.15);
box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);
}

.btn {
width: 100%;
padding: 15px;
border-radius: 12px;
border: none;
background: linear-gradient(135deg, #ff8c00, #ff0080);
color: white;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
margin-bottom: 10px;
}

.btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 20px rgba(255, 140, 0, 0.5);
}

.btn:active {
transform: translateY(0);
}

.shake {
animation: shake 0.5s;
}

.error-message {
color: #ff0080;
text-align: center;
font-size: 14px;
margin-top: 10px;
padding: 10px;
background: rgba(255, 0, 128, 0.1);
border-radius: 8px;
border: 1px solid rgba(255, 0, 128, 0.3);
display: none;
}

.error-message.show {
display: block;
animation: fadeIn 0.3s;
}

.login-screen {
max-width: 450px;
}

.admin-panel {
display: none;
max-width: 900px;
}

.admin-panel.active {
display: block;
}

.welcome-banner {
background: rgba(0, 255, 100, 0.2);
border: 1px solid rgba(0, 255, 100, 0.4);
color: #00ff88;
padding: 15px;
border-radius: 10px;
text-align: center;
margin-bottom: 20px;
animation: pulse 2s infinite;
}

.admin-badge {
display: inline-block;
padding: 4px 12px;
border-radius: 12px;
font-size: 12px;
font-weight: 600;
margin-left: 10px;
}

.admin-badge.super {
background: linear-gradient(135deg, #ff0080, #ff8c00);
}

.admin-badge.regular {
background: rgba(255, 255, 255, 0.2);
}

.command-section {
background: rgba(255, 255, 255, 0.05);
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.command-section h3 {
color: #ff8c00;
margin-bottom: 15px;
font-size: 18px;
display: flex;
align-items: center;
gap: 10px;
}

.command-btn {
background: rgba(255, 255, 255, 0.08);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 12px;
color: white;
padding: 15px 20px;
cursor: pointer;
transition: all 0.3s;
width: 100%;
text-align: left;
font-size: 14px;
margin-bottom: 10px;
display: flex;
align-items: center;
justify-content: space-between;
}

.command-btn:hover {
background: rgba(255, 255, 255, 0.15);
transform: translateX(5px);
border-color: #ff8c00;
}

.command-btn .icon {
font-size: 20px;
}

.stats-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
}

.stat-card {
background: rgba(255, 255, 255, 0.05);
border-radius: 12px;
padding: 15px;
text-align: center;
border: 1px solid rgba(255, 255, 255, 0.1);
transition: all 0.3s;
}

.stat-card:hover {
background: rgba(255, 255, 255, 0.08);
transform: translateY(-2px);
}

.stat-value {
font-size: 28px;
font-weight: 700;
color: #ff8c00;
margin-bottom: 5px;
}

.stat-label {
font-size: 12px;
color: rgba(255, 255, 255, 0.6);
}

.terminal {
background: rgba(0, 0, 0, 0.5);
border-radius: 12px;
padding: 15px;
font-family: 'Courier New', monospace;
font-size: 13px;
color: #00ff00;
max-height: 200px;
overflow-y: auto;
margin-bottom: 15px;
border: 1px solid rgba(0, 255, 0, 0.3);
}

.terminal-container {
margin-bottom: 15px;
}

.terminal-line {
margin-bottom: 5px;
}

.terminal-prompt {
color: #ff8c00;
}

.logout-btn {
background: rgba(255, 0, 100, 0.2);
border: 1px solid rgba(255, 0, 100, 0.4);
border-radius: 12px;
color: white;
padding: 15px;
cursor: pointer;
transition: all 0.3s;
width: 100%;
text-align: center;
font-size: 16px;
font-weight: 600;
margin-top: 20px;
}

.logout-btn:hover {
background: rgba(255, 0, 100, 0.3);
transform: scale(1.02);
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
backdrop-filter: blur(10px);
z-index: 1000;
align-items: center;
justify-content: center;
padding: 20px;
}

.modal.active {
display: flex;
}

.modal-content {
background: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.2);
padding: 30px;
max-width: 600px;
width: 100%;
max-height: 80vh;
overflow-y: auto;
animation: fadeIn 0.3s ease;
}

.modal-header {
font-size: 24px;
margin-bottom: 20px;
color: #ff8c00;
}

.modal-body {
margin-bottom: 20px;
line-height: 1.6;
}

.modal-input {
width: 100%;
padding: 12px;
margin-bottom: 10px;
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 10px;
color: white;
font-size: 14px;
font-family: inherit;
}

.modal-input::placeholder {
color: rgba(255, 255, 255, 0.5);
}

.modal-buttons {
display: flex;
gap: 10px;
}

.modal-btn {
flex: 1;
padding: 12px;
border-radius: 10px;
cursor: pointer;
font-weight: 600;
transition: all 0.3s;
border: none;
font-size: 14px;
}

.modal-btn.primary {
background: linear-gradient(135deg, #ff8c00, #ff0080);
color: white;
}

.modal-btn.primary:hover {
transform: scale(1.05);
box-shadow: 0 4px 15px rgba(255, 140, 0, 0.5);
}

.modal-btn.secondary {
background: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
color: white;
}

.modal-btn.secondary:hover {
background: rgba(255, 255, 255, 0.2);
}

.user-list, .admin-list {
max-height: 300px;
overflow-y: auto;
}

.user-item, .admin-item {
background: rgba(255, 255, 255, 0.05);
border-radius: 10px;
padding: 12px;
margin-bottom: 8px;
display: flex;
justify-content: space-between;
align-items: center;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.user-info, .admin-info {
flex: 1;
}

.user-email, .admin-username {
font-size: 14px;
color: white;
margin-bottom: 3px;
}

.user-date, .admin-role {
font-size: 12px;
color: rgba(255, 255, 255, 0.5);
}

.action-btn {
padding: 8px 15px;
border-radius: 8px;
font-size: 12px;
cursor: pointer;
transition: all 0.3s;
background: rgba(255, 0, 100, 0.2);
border: 1px solid rgba(255, 0, 100, 0.4);
color: white;
margin-left: 5px;
}

.action-btn:hover {
background: rgba(255, 0, 100, 0.3);
}

.success-message {
background: rgba(0, 255, 100, 0.2);
border: 1px solid rgba(0, 255, 100, 0.4);
color: #00ff88;
padding: 15px;
border-radius: 10px;
text-align: center;
margin-bottom: 15px;
}

@media (max-width: 768px) {
.glass-card {
padding: 25px;
}
.stats-grid {
grid-template-columns: 1fr;
}
}
</style>
</head>
<body>
<div class="aurora-bg"></div>

<div class="container">
<!-- Login Screen -->
<div id="loginScreen" class="login-screen">
<div class="glass-card">
<div class="admin-header">
<h1>üîê ADMIN ACCESS</h1>
<p>Authorized Personnel Only</p>
</div>
<input type="text" id="username" class="input-field" placeholder="Enter Username" autocomplete="username">
<input type="password" id="password" class="input-field" placeholder="Enter Password" autocomplete="current-password">
<button class="btn" onclick="login()">Login</button>
<div class="error-message" id="errorMessage"></div>
</div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel">
<div class="glass-card">
<div class="admin-header">
<h1>‚ö° ADMIN CONTROL PANEL</h1>
<p>MyTimetable System Administration</p>
</div>

<div class="welcome-banner" id="welcomeBanner">
‚úÖ Authentication Successful - Welcome, <span id="adminName"></span><span id="adminBadge" class="admin-badge"></span>
</div>

<!-- Main Dashboard -->
<div class="command-section">
<h3>üè† Main Dashboard</h3>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 15px;">
<div style="background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
<div style="font-size: 24px; margin-bottom: 8px;">‚ö°</div>
<div style="font-size: 14px; color: rgba(255,255,255,0.9); margin-bottom: 5px;">System Status</div>
<div style="font-size: 18px; color: #00ff88; font-weight: 600;" id="systemStatus">Online</div>
</div>
<div style="background: rgba(255, 140, 0, 0.1); border: 1px solid rgba(255, 140, 0, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
<div style="font-size: 24px; margin-bottom: 8px;">üìä</div>
<div style="font-size: 14px; color: rgba(255,255,255,0.9); margin-bottom: 5px;">Storage Used</div>
<div style="font-size: 18px; color: #ff8c00; font-weight: 600;" id="storageUsed">0 KB</div>
</div>
<div style="background: rgba(255, 0, 128, 0.1); border: 1px solid rgba(255, 0, 128, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
<div style="font-size: 24px; margin-bottom: 8px;">üîÑ</div>
<div style="font-size: 14px; color: rgba(255,255,255,0.9); margin-bottom: 5px;">Last Sync</div>
<div style="font-size: 18px; color: #ff0080; font-weight: 600;" id="lastSync">Just now</div>
</div>
</div>
<button class="command-btn" onclick="refreshDashboard()">
<span>Refresh Dashboard</span>
<span class="icon">üîÑ</span>
</button>
</div>

<!-- System Statistics -->
<div class="command-section">
<h3>üìä System Statistics</h3>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-value" id="totalUsers">0</div>
<div class="stat-label">Total Users</div>
</div>
<div class="stat-card">
<div class="stat-value" id="activeUsers">0</div>
<div class="stat-label">Active Today</div>
</div>
<div class="stat-card">
<div class="stat-value" id="totalNotes">0</div>
<div class="stat-label">Notes Created</div>
</div>
<div class="stat-card">
<div class="stat-value" id="customTimetables">0</div>
<div class="stat-label">Custom Timetables</div>
</div>
</div>
</div>

<!-- Admin Management (Only for Super Admin) -->
<div class="command-section" id="adminManagementSection" style="display: none;">
<h3>üëë Admin Management</h3>
<button class="command-btn" onclick="viewAdmins()">
<span>View All Admins</span>
<span class="icon">üë•</span>
</button>
<button class="command-btn" onclick="addNewAdmin()">
<span>Add New Admin</span>
<span class="icon">‚ûï</span>
</button>
</div>

<!-- User Management -->
<div class="command-section">
<h3>üë• User Management</h3>
<button class="command-btn" onclick="viewAllUsers()">
<span>View All Users</span>
<span class="icon">üëÅÔ∏è</span>
</button>
<button class="command-btn" onclick="exportUserData()">
<span>Export User Data</span>
<span class="icon">üì•</span>
</button>
<button class="command-btn" onclick="broadcastMessage()">
<span>Send Broadcast Message</span>
<span class="icon">üì¢</span>
</button>
</div>

<!-- Database Management -->
<div class="command-section">
<h3>üíæ Database Management</h3>
<button class="command-btn" onclick="backupDatabase()">
<span>Backup Database</span>
<span class="icon">üíø</span>
</button>
<button class="command-btn" onclick="clearCache()">
<span>Clear System Cache</span>
<span class="icon">üóëÔ∏è</span>
</button>
<button class="command-btn" onclick="viewLogs()">
<span>View System Logs</span>
<span class="icon">üìã</span>
</button>
</div>

<!-- System Control -->
<div class="command-section">
<h3>‚öôÔ∏è System Control</h3>
<button class="command-btn" onclick="toggleMaintenance()">
<span>Toggle Maintenance Mode</span>
<span class="icon">üîß</span>
</button>
<button class="command-btn" onclick="forceSync()">
<span>Force Data Sync</span>
<span class="icon">üîÑ</span>
</button>
<button class="command-btn" onclick="resetDemo()">
<span>Reset Demo Account</span>
<span class="icon">üîÑ</span>
</button>
</div>

<!-- Tests & Diagnostics -->
<div class="command-section">
<h3>üß™ Tests & Diagnostics</h3>
<button class="command-btn" onclick="testOAuth()">
<span>Test OAuth Connection</span>
<span class="icon">üîê</span>
</button>
<button class="command-btn" onclick="testDatabase()">
<span>Test Database Connection</span>
<span class="icon">üíæ</span>
</button>
<button class="command-btn" onclick="testNotifications()">
<span>Test Notification System</span>
<span class="icon">üîî</span>
</button>
<button class="command-btn" onclick="runDiagnostics()">
<span>Run Full System Diagnostics</span>
<span class="icon">üî¨</span>
</button>
</div>

<!-- Terminals -->
<div class="command-section">
<h3>üíª System Terminals</h3>
<div style="margin-bottom: 15px;">
<div style="display: flex; gap: 10px; margin-bottom: 10px;">
<button class="command-btn" onclick="showTerminal('main')" style="flex: 1; margin: 0; background: rgba(0, 255, 0, 0.1); border-color: rgba(0, 255, 0, 0.3);">
<span>Main Terminal</span>
</button>
<button class="command-btn" onclick="showTerminal('auth')" style="flex: 1; margin: 0; background: rgba(0, 212, 255, 0.1); border-color: rgba(0, 212, 255, 0.3);">
<span>Auth Terminal</span>
</button>
<button class="command-btn" onclick="showTerminal('database')" style="flex: 1; margin: 0; background: rgba(255, 140, 0, 0.1); border-color: rgba(255, 140, 0, 0.3);">
<span>Database Terminal</span>
</button>
</div>
</div>

<!-- Main Terminal -->
<div id="terminal-main" class="terminal-container" style="display: block;">
<div style="background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 8px 8px 0 0; border: 1px solid rgba(0,255,0,0.3); border-bottom: none; display: flex; justify-content: space-between; align-items: center;">
<span style="color: #00ff00; font-size: 12px; font-weight: 600;">‚óè Main System Terminal</span>
<button onclick="clearTerminal('main')" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.4); color: white; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 11px;">Clear</button>
</div>
<div class="terminal" id="terminal">
<div class="terminal-line"><span class="terminal-prompt">admin@mytimetable:~$</span> System initialized</div>
<div class="terminal-line"><span class="terminal-prompt">admin@mytimetable:~$</span> Ready for commands...</div>
</div>
</div>

<!-- Auth Terminal -->
<div id="terminal-auth" class="terminal-container" style="display: none;">
<div style="background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 8px 8px 0 0; border: 1px solid rgba(0,212,255,0.3); border-bottom: none; display: flex; justify-content: space-between; align-items: center;">
<span style="color: #00d4ff; font-size: 12px; font-weight: 600;">‚óè Authentication Terminal</span>
<button onclick="clearTerminal('auth')" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.4); color: white; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 11px;">Clear</button>
</div>
<div class="terminal" id="terminalAuth">
<div class="terminal-line"><span style="color: #00d4ff;">auth@mytimetable:~$</span> Authentication system ready</div>
<div class="terminal-line"><span style="color: #00d4ff;">auth@mytimetable:~$</span> Monitoring OAuth connections...</div>
</div>
</div>

<!-- Database Terminal -->
<div id="terminal-database" class="terminal-container" style="display: none;">
<div style="background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 8px 8px 0 0; border: 1px solid rgba(255,140,0,0.3); border-bottom: none; display: flex; justify-content: space-between; align-items: center;">
<span style="color: #ff8c00; font-size: 12px; font-weight: 600;">‚óè Database Terminal</span>
<button onclick="clearTerminal('database')" style="background: rgba(255,0,0,0.2); border: 1px solid rgba(255,0,0,0.4); color: white; padding: 4px 10px; border-radius: 5px; cursor: pointer; font-size: 11px;">Clear</button>
</div>
<div class="terminal" id="terminalDatabase">
<div class="terminal-line"><span style="color: #ff8c00;">db@mytimetable:~$</span> Database connection established</div>
<div class="terminal-line"><span style="color: #ff8c00;">db@mytimetable:~$</span> Monitoring storage operations...</div>
</div>
</div>
</div>

<!-- Original Terminal Section (now hidden, keeping for compatibility) -->
<div class="command-section" style="display: none;">
<h3>üíª System Terminal</h3>
<div class="terminal" id="terminal">
<div class="terminal-line"><span class="terminal-prompt">admin@mytimetable:~$</span> System initialized</div>
<div class="terminal-line"><span class="terminal-prompt">admin@mytimetable:~$</span> Ready for commands...</div>
</div>
</div>

<button class="logout-btn" onclick="logout()">üö™ Logout</button>
</div>
</div>
</div>

<!-- Modal -->
<div id="modal" class="modal" onclick="if(event.target.id==='modal') closeModal()">
<div class="modal-content">
<div class="modal-header" id="modalHeader">Modal Title</div>
<div class="modal-body" id="modalBody">Modal content</div>
<div class="modal-buttons" id="modalButtons">
<button class="modal-btn secondary" onclick="closeModal()">Close</button>
</div>
</div>
</div>

<script>
const supabase = window.supabase.createClient(
'https://vuuyxmazxnpbbkppmvyh.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1dXl4bWF6eG5wYmJrcHBtdnloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNDQ5NjgsImV4cCI6MjA3NzgyMDk2OH0.dQMR1b_4Q8NbqT_FprAmzLFu5H4jm8gWfgCGI3-MAzQ'
);

let currentAdmin = null;
let loginAttempts = 0;

// Default admins stored in localStorage
function initializeAdmins() {
const admins = getAdmins();
if (admins.length === 0) {
// Initialize with default admins
const defaultAdmins = [
{ username: 'ronitmantri', password: '123456789', isSuperAdmin: true, createdAt: new Date().toISOString() },
{ username: 'kabir', password: '12345', isSuperAdmin: false, createdAt: new Date().toISOString() }
];
localStorage.setItem('admin_accounts', JSON.stringify(defaultAdmins));
}
}

function getAdmins() {
const admins = localStorage.getItem('admin_accounts');
return admins ? JSON.parse(admins) : [];
}

function saveAdmins(admins) {
localStorage.setItem('admin_accounts', JSON.stringify(admins));
}

// Initialize
function init() {
initializeAdmins();
loadStats();
addLog('System ready');
updateDashboard();
}

// Dashboard Functions
function updateDashboard() {
// Update system status
document.getElementById('systemStatus').textContent = 'Online';
addLog('Dashboard updated');

// Calculate storage used
let totalSize = 0;
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key) {
const value = localStorage.getItem(key);
totalSize += key.length + (value ? value.length : 0);
}
}
const sizeKB = (totalSize / 1024).toFixed(2);
document.getElementById('storageUsed').textContent = sizeKB + ' KB';

// Update last sync time
const now = new Date();
document.getElementById('lastSync').textContent = now.toLocaleTimeString();
}

function refreshDashboard() {
addLog('Refreshing dashboard...');
updateDashboard();
loadStats();
showModal('Dashboard Refreshed', '<p style="color: #00ff88;">‚úÖ Dashboard data has been refreshed!</p>');
}

// Terminal Management
function showTerminal(type) {
// Hide all terminals
document.getElementById('terminal-main').style.display = 'none';
document.getElementById('terminal-auth').style.display = 'none';
document.getElementById('terminal-database').style.display = 'none';

// Show selected terminal
document.getElementById('terminal-' + type).style.display = 'block';
addLog(`Switched to ${type} terminal`);
}

function clearTerminal(type) {
let terminalId;
let prompt;
let promptColor;
let message;

switch(type) {
case 'main':
terminalId = 'terminal';
prompt = 'admin@mytimetable:~$';
promptColor = '#ff8c00';
message = 'Terminal cleared';
break;
case 'auth':
terminalId = 'terminalAuth';
prompt = 'auth@mytimetable:~$';
promptColor = '#00d4ff';
message = 'Authentication terminal ready';
break;
case 'database':
terminalId = 'terminalDatabase';
prompt = 'db@mytimetable:~$';
promptColor = '#ff8c00';
message = 'Database terminal ready';
break;
}

const terminal = document.getElementById(terminalId);
if (terminal) {
terminal.innerHTML = `<div class="terminal-line"><span style="color: ${promptColor};">${prompt}</span> ${message}</div>`;
}
addLog(`${type} terminal cleared`);
}

function addLogToTerminal(terminalId, message, promptText, promptColor) {
const terminal = document.getElementById(terminalId);
if (terminal) {
const line = document.createElement('div');
line.className = 'terminal-line';
const time = new Date().toLocaleTimeString();
line.innerHTML = `<span style="color: ${promptColor};">${promptText}</span> [${time}] ${message}`;
terminal.appendChild(line);
terminal.scrollTop = terminal.scrollHeight;
}
}

// Test Functions
async function testOAuth() {
addLog('Starting OAuth connection test...');
addLogToTerminal('terminalAuth', 'Initiating OAuth test...', 'auth@mytimetable:~$', '#00d4ff');
showModal('OAuth Test', '<div style="text-align: center; padding: 20px;"><div style="font-size: 48px; margin-bottom: 20px;">üîÑ</div><p>Testing OAuth configuration...</p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">Check console for details</p></div>');

try {
console.log('=== OAuth Configuration Test ===');
console.log('Current URL:', window.location.href);
console.log('Supabase URL:', 'https://vuuyxmazxnpbbkppmvyh.supabase.co');
addLogToTerminal('terminalAuth', 'Checking Supabase connection...', 'auth@mytimetable:~$', '#00d4ff');

// Test session
const { data: sessionData, error: sessionError } = await supabase.auth.getSession();
console.log('Session check:', sessionError ? 'Error: ' + sessionError.message : 'OK');
addLogToTerminal('terminalAuth', sessionError ? '‚ùå Session check failed' : '‚úÖ Session check passed', 'auth@mytimetable:~$', '#00d4ff');

// Test GitHub OAuth
console.log('Testing GitHub OAuth...');
addLogToTerminal('terminalAuth', 'Testing GitHub OAuth provider...', 'auth@mytimetable:~$', '#00d4ff');
const { data: githubData, error: githubError } = await supabase.auth.signInWithOAuth({
provider: 'github',
options: { 
redirectTo: window.location.origin + window.location.pathname,
skipBrowserRedirect: true
}
});

let resultHtml = '<div style="font-family: monospace; text-align: left; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; max-height: 400px; overflow-y: auto;">';
resultHtml += '<div style="color: #00ff88; margin-bottom: 15px; font-size: 18px;">üìä OAuth Test Results</div>';
resultHtml += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">Session:</span> ' + (sessionError ? '<span style="color: #ff0080;">‚ùå Failed</span>' : '<span style="color: #00ff88;">‚úÖ OK</span>') + '</div>';

if (githubError) {
console.error('GitHub OAuth error:', githubError);
addLogToTerminal('terminalAuth', '‚ùå GitHub OAuth: ' + githubError.message, 'auth@mytimetable:~$', '#00d4ff');
resultHtml += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">GitHub OAuth:</span> <span style="color: #ff0080;">‚ùå ' + githubError.message + '</span></div>';
if (githubError.message.includes('not enabled')) {
resultHtml += '<div style="margin-top: 15px; padding: 15px; background: rgba(255,0,0,0.1); border-left: 3px solid #ff0080; border-radius: 5px; font-size: 13px;"><strong>Configuration Required:</strong><br>‚Ä¢ Go to Supabase Dashboard<br>‚Ä¢ Navigate to Authentication ‚Üí Providers<br>‚Ä¢ Enable GitHub OAuth<br>‚Ä¢ Add OAuth credentials</div>';
}
} else {
console.log('GitHub OAuth: OK');
addLogToTerminal('terminalAuth', '‚úÖ GitHub OAuth configured', 'auth@mytimetable:~$', '#00d4ff');
resultHtml += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">GitHub OAuth:</span> <span style="color: #00ff88;">‚úÖ Configured</span></div>';
}

resultHtml += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); font-size: 12px;">Test completed at ' + new Date().toLocaleTimeString() + '</div>';
resultHtml += '</div>';

showModal('OAuth Test Results', resultHtml);
addLog('OAuth test completed');
console.log('=== End of OAuth Test ===');
} catch (err) {
console.error('Test error:', err);
addLogToTerminal('terminalAuth', '‚ùå Test failed: ' + err.message, 'auth@mytimetable:~$', '#00d4ff');
showModal('OAuth Test Failed', '<p style="color: #ff0080;">‚ùå Test failed: ' + err.message + '</p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">Check console for details</p>');
addLog('OAuth test failed: ' + err.message);
}
}

async function testDatabase() {
addLog('Testing database connection...');
addLogToTerminal('terminalDatabase', 'Starting database test...', 'db@mytimetable:~$', '#ff8c00');

try {
// Count items
let itemCount = 0;
let totalSize = 0;
const items = {};

for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key) {
const value = localStorage.getItem(key);
const size = key.length + (value ? value.length : 0);
totalSize += size;
itemCount++;
items[key] = (size / 1024).toFixed(2) + ' KB';
}
}

addLogToTerminal('terminalDatabase', `Found ${itemCount} items`, 'db@mytimetable:~$', '#ff8c00');
addLogToTerminal('terminalDatabase', `Total size: ${(totalSize / 1024).toFixed(2)} KB`, 'db@mytimetable:~$', '#ff8c00');

let html = '<div style="font-family: monospace; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px;">';
html += '<div style="color: #ff8c00; margin-bottom: 15px; font-size: 18px;">üíæ Database Test Results</div>';
html += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">Status:</span> <span style="color: #00ff88;">‚úÖ Connected</span></div>';
html += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">Items:</span> ' + itemCount + '</div>';
html += '<div style="margin-bottom: 10px;"><span style="color: #00d4ff;">Total Size:</span> ' + (totalSize / 1024).toFixed(2) + ' KB</div>';
html += '<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);"><strong>Storage Breakdown:</strong></div>';
html += '<div style="max-height: 200px; overflow-y: auto; margin-top: 10px;">';
Object.keys(items).forEach(key => {
html += '<div style="font-size: 12px; margin-bottom: 5px; color: rgba(255,255,255,0.8);">' + key + ': ' + items[key] + '</div>';
});
html += '</div></div>';

showModal('Database Test Results', html);
addLogToTerminal('terminalDatabase', '‚úÖ Database test completed', 'db@mytimetable:~$', '#ff8c00');
addLog('Database test completed successfully');
} catch (err) {
addLogToTerminal('terminalDatabase', '‚ùå Test failed: ' + err.message, 'db@mytimetable:~$', '#ff8c00');
showModal('Database Test Failed', '<p style="color: #ff0080;">‚ùå ' + err.message + '</p>');
addLog('Database test failed: ' + err.message);
}
}

function testNotifications() {
addLog('Testing notification system...');
if ('Notification' in window) {
if (Notification.permission === 'granted') {
new Notification('MyTimetable Admin', {
body: 'Notification system is working correctly!',
icon: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png'
});
showModal('Notification Test', '<p style="color: #00ff88;">‚úÖ Notification sent successfully!</p>');
addLog('Test notification sent');
} else if (Notification.permission !== 'denied') {
Notification.requestPermission().then(permission => {
if (permission === 'granted') {
new Notification('MyTimetable Admin', {
body: 'Notification system is working correctly!',
icon: 'https://i.ibb.co/21BL0FJy/842529-FA-2829-464-E-88-B2-B831-CCEBB9-F9.png'
});
showModal('Notification Test', '<p style="color: #00ff88;">‚úÖ Notification permission granted and test sent!</p>');
addLog('Notification permission granted');
} else {
showModal('Notification Test', '<p style="color: #ff0080;">‚ùå Notification permission denied</p>');
addLog('Notification permission denied');
}
});
} else {
showModal('Notification Test', '<p style="color: #ff0080;">‚ùå Notifications are blocked</p>');
addLog('Notifications blocked by user');
}
} else {
showModal('Notification Test', '<p style="color: #ff0080;">‚ùå Notifications not supported in this browser</p>');
addLog('Notifications not supported');
}
}

function runDiagnostics() {
addLog('Running full system diagnostics...');
addLogToTerminal('terminalAuth', 'Starting diagnostics...', 'auth@mytimetable:~$', '#00d4ff');
addLogToTerminal('terminalDatabase', 'Scanning database...', 'db@mytimetable:~$', '#ff8c00');

let html = '<div style="font-family: monospace; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px;">';
html += '<div style="color: #00ff88; margin-bottom: 20px; font-size: 20px;">üî¨ System Diagnostics</div>';

// Browser info
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Browser:</strong> ' + navigator.userAgent.split(' ').pop() + '</div>';
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Platform:</strong> ' + navigator.platform + '</div>';
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Language:</strong> ' + navigator.language + '</div>';
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Online:</strong> ' + (navigator.onLine ? '<span style="color: #00ff88;">‚úÖ Yes</span>' : '<span style="color: #ff0080;">‚ùå No</span>') + '</div>';

// Storage
let storageUsed = 0;
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key) {
const value = localStorage.getItem(key);
storageUsed += key.length + (value ? value.length : 0);
}
}
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Storage Used:</strong> ' + (storageUsed / 1024).toFixed(2) + ' KB</div>';
html += '<div style="margin-bottom: 15px;"><strong style="color: #00d4ff;">Items Stored:</strong> ' + localStorage.length + '</div>';

// Features
html += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);"><strong>Feature Support:</strong></div>';
html += '<div style="margin-top: 10px; font-size: 13px;">';
html += '<div style="margin-bottom: 8px;">‚Ä¢ LocalStorage: <span style="color: #00ff88;">‚úÖ Supported</span></div>';
html += '<div style="margin-bottom: 8px;">‚Ä¢ Notifications: ' + ('Notification' in window ? '<span style="color: #00ff88;">‚úÖ Supported</span>' : '<span style="color: #ff0080;">‚ùå Not Supported</span>') + '</div>';
html += '<div style="margin-bottom: 8px;">‚Ä¢ Service Workers: ' + ('serviceWorker' in navigator ? '<span style="color: #00ff88;">‚úÖ Supported</span>' : '<span style="color: #ff0080;">‚ùå Not Supported</span>') + '</div>';
html += '</div>';

html += '<div style="margin-top: 20px; padding: 10px; background: rgba(0,255,0,0.1); border-radius: 8px; text-align: center; color: #00ff88;">All systems operational</div>';
html += '</div>';

showModal('System Diagnostics', html);
addLogToTerminal('terminalAuth', '‚úÖ Diagnostics completed', 'auth@mytimetable:~$', '#00d4ff');
addLogToTerminal('terminalDatabase', '‚úÖ All checks passed', 'db@mytimetable:~$', '#ff8c00');
addLog('Full diagnostics completed');
}

// Login
async function login() {
const username = document.getElementById('username').value.trim();
const password = document.getElementById('password').value;
const errorMsg = document.getElementById('errorMessage');

if (!username || !password) {
showError('Please enter both username and password');
return;
}

const admins = getAdmins();
const admin = admins.find(a => a.username === username && a.password === password);

if (admin) {
currentAdmin = admin;
document.getElementById('loginScreen').style.display = 'none';
document.getElementById('adminPanel').classList.add('active');
document.getElementById('adminName').textContent = admin.username;
document.getElementById('adminBadge').textContent = admin.isSuperAdmin ? 'Super Admin' : 'Admin';
document.getElementById('adminBadge').className = 'admin-badge ' + (admin.isSuperAdmin ? 'super' : 'regular');

// Show admin management section only for super admin
if (admin.isSuperAdmin) {
document.getElementById('adminManagementSection').style.display = 'block';
}

addLog(`Admin logged in: ${admin.username} (${admin.isSuperAdmin ? 'Super Admin' : 'Admin'})`);
addLogToTerminal('terminalAuth', `Admin authenticated: ${admin.username}`, 'auth@mytimetable:~$', '#00d4ff');
loadStats();
updateDashboard();
} else {
loginAttempts++;
showError('Invalid username or password');
addLogToTerminal('terminalAuth', `Failed authentication attempt for: ${username}`, 'auth@mytimetable:~$', '#00d4ff');
document.querySelector('.glass-card').classList.add('shake');
setTimeout(() => {
document.querySelector('.glass-card').classList.remove('shake');
}, 500);
addLog(`Failed login attempt #${loginAttempts} for username: ${username}`);
}
}

function showError(message) {
const errorMsg = document.getElementById('errorMessage');
errorMsg.textContent = '‚ùå ' + message;
errorMsg.classList.add('show');
setTimeout(() => {
errorMsg.classList.remove('show');
}, 3000);
}

// Admin Management Functions
function viewAdmins() {
const admins = getAdmins();
let html = '<div class="admin-list">';
if (admins.length === 0) {
html += '<p style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No admins found</p>';
} else {
admins.forEach(admin => {
html += `
<div class="admin-item">
<div class="admin-info">
<div class="admin-username">${admin.username} ${admin.isSuperAdmin ? 'üëë' : ''}</div>
<div class="admin-role">${admin.isSuperAdmin ? 'Super Admin' : 'Admin'} ‚Ä¢ Created: ${new Date(admin.createdAt).toLocaleDateString()}</div>
</div>
${!admin.isSuperAdmin ? `<button class="action-btn" onclick="deleteAdmin('${admin.username}')">Delete</button>` : '<span style="color: rgba(255,255,255,0.3); font-size: 12px;">Protected</span>'}
</div>
`;
});
}
html += '</div>';

showModal('All Admins', html);
addLog('Viewed all admins');
}

function addNewAdmin() {
const html = `
<p style="margin-bottom: 15px; color: rgba(255,255,255,0.8);">Create a new admin account:</p>
<input type="text" id="newAdminUsername" class="modal-input" placeholder="Username" autocomplete="off">
<input type="password" id="newAdminPassword" class="modal-input" placeholder="Password" autocomplete="new-password">
<p style="font-size: 12px; color: rgba(255,255,255,0.5); margin-top: 10px;">Note: New admins will not have permission to add more admins.</p>
`;
showModal('Add New Admin', html, [
{ text: 'Create Admin', class: 'primary', action: createAdmin },
{ text: 'Cancel', class: 'secondary', action: closeModal }
]);
addLog('Opened add admin interface');
}

function createAdmin() {
const username = document.getElementById('newAdminUsername').value.trim();
const password = document.getElementById('newAdminPassword').value;

if (!username || !password) {
alert('Please enter both username and password');
return;
}

if (username.length < 3) {
alert('Username must be at least 3 characters');
return;
}

if (password.length < 5) {
alert('Password must be at least 5 characters');
return;
}

const admins = getAdmins();
if (admins.find(a => a.username === username)) {
alert('Username already exists');
return;
}

admins.push({
username: username,
password: password,
isSuperAdmin: false,
createdAt: new Date().toISOString(),
createdBy: currentAdmin.username
});

saveAdmins(admins);
addLog(`New admin created: ${username} by ${currentAdmin.username}`);
showModal('Admin Created', `<p style="color: #00ff88;">‚úÖ Admin account created successfully!</p><p style="margin-top: 10px;">Username: <strong>${username}</strong><br>Password: <strong>${password}</strong></p><p style="margin-top: 15px; padding: 10px; background: rgba(255,140,0,0.1); border-radius: 8px; font-size: 13px; color: rgba(255,255,255,0.7);">‚ö†Ô∏è Make sure to save these credentials securely!</p>`);
}

function deleteAdmin(username) {
if (confirm(`Delete admin "${username}"? This action cannot be undone.`)) {
let admins = getAdmins();
admins = admins.filter(a => a.username !== username);
saveAdmins(admins);
addLog(`Admin deleted: ${username} by ${currentAdmin.username}`);
closeModal();
setTimeout(() => {
showModal('Admin Deleted', `<p style="color: #00ff88;">‚úÖ Admin "${username}" has been deleted.</p>`);
}, 300);
}
}

// Statistics
function loadStats() {
let userCount = 0;
let notesCount = 0;
let customTimetableCount = 0;

for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && key.startsWith('notes_')) {
const notes = JSON.parse(localStorage.getItem(key) || '[]');
notesCount += notes.length;
userCount++;
}
if (key && key.startsWith('custom_timetable_')) {
customTimetableCount++;
}
}

document.getElementById('totalUsers').textContent = userCount;
document.getElementById('activeUsers').textContent = Math.floor(userCount * 0.7);
document.getElementById('totalNotes').textContent = notesCount;
document.getElementById('customTimetables').textContent = customTimetableCount;
}

// User Management
function viewAllUsers() {
let userList = [];
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && key.startsWith('notes_')) {
const userId = key.replace('notes_', '');
const notes = JSON.parse(localStorage.getItem(key) || '[]');
userList.push({
id: userId,
email: userId === 'guest' ? 'Guest User' : userId,
notesCount: notes.length,
lastActive: notes.length > 0 ? new Date(notes[0].date).toLocaleDateString() : 'N/A'
});
}
}

let html = '<div class="user-list">';
if (userList.length === 0) {
html += '<p style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">No users found</p>';
} else {
userList.forEach(user => {
html += `
<div class="user-item">
<div class="user-info">
<div class="user-email">${user.email}</div>
<div class="user-date">Last active: ${user.lastActive} ‚Ä¢ ${user.notesCount} notes</div>
</div>
<button class="action-btn" onclick="deleteUser('${user.id}')">Delete</button>
</div>
`;
});
}
html += '</div>';

showModal('All Users', html);
addLog('Viewed all users');
}

function deleteUser(userId) {
if (confirm(`Delete user ${userId}? This will remove all their data permanently.`)) {
addLogToTerminal('terminalDatabase', `Deleting user: ${userId}...`, 'db@mytimetable:~$', '#ff8c00');
localStorage.removeItem('notes_' + userId);
localStorage.removeItem('custom_timetable_' + userId);
localStorage.removeItem('timetable_selected_' + userId);
localStorage.removeItem('timetable_type_' + userId);
addLog(`Deleted user: ${userId} by ${currentAdmin.username}`);
addLogToTerminal('terminalDatabase', `‚úÖ User ${userId} deleted`, 'db@mytimetable:~$', '#ff8c00');
closeModal();
setTimeout(() => {
showModal('User Deleted', `<p style="color: #00ff88;">‚úÖ User "${userId}" and all associated data have been permanently deleted.</p>`);
loadStats();
}, 300);
}
}

function exportUserData() {
const data = {
timestamp: new Date().toISOString(),
exportedBy: currentAdmin.username,
users: [],
notes: {},
timetables: {}
};

for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && key.startsWith('notes_')) {
const userId = key.replace('notes_', '');
data.users.push(userId);
data.notes[userId] = JSON.parse(localStorage.getItem(key) || '[]');
}
if (key && key.startsWith('custom_timetable_')) {
const userId = key.replace('custom_timetable_', '');
data.timetables[userId] = JSON.parse(localStorage.getItem(key) || '{}');
}
}

const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
const filename = `mytimetable-export-${new Date().toISOString().split('T')[0]}.json`;
a.download = filename;
a.click();
URL.revokeObjectURL(url);

addLog('Exported user data: ' + filename);
showModal('Export Complete', `<p style="color: #00ff88;">‚úÖ User data exported successfully!</p><p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 15px;">File: ${filename}<br>Total users: ${data.users.length}</p>`);
}

function broadcastMessage() {
const html = `
<p style="margin-bottom: 15px; color: rgba(255,255,255,0.8);">Send a message to all MyTimetable users:</p>
<textarea id="broadcastMsg" class="modal-input" placeholder="Enter your message..." style="min-height: 120px; resize: vertical; font-family: inherit;"></textarea>
`;
showModal('Broadcast Message', html, [
{ text: 'Send', class: 'primary', action: sendBroadcast },
{ text: 'Cancel', class: 'secondary', action: closeModal }
]);
addLog('Opened broadcast interface');
}

function sendBroadcast() {
const message = document.getElementById('broadcastMsg').value.trim();
if (!message) {
alert('Please enter a message');
return;
}
localStorage.setItem('admin_broadcast', JSON.stringify({
message: message,
timestamp: new Date().toISOString(),
sentBy: currentAdmin.username,
read: false
}));
addLog(`Broadcast sent by ${currentAdmin.username}: "${message.substring(0, 30)}${message.length > 30 ? '...' : ''}"`);
showModal('Broadcast Sent', `<p style="color: #00ff88;">‚úÖ Message broadcast to all users!</p><div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; border-left: 3px solid #ff8c00;"><p style="font-style: italic; color: rgba(255,255,255,0.9);">"${message}"</p></div>`);
}

// Database Management
function backupDatabase() {
const backup = {
timestamp: new Date().toISOString(),
version: '1.0',
backedUpBy: currentAdmin.username,
data: {}
};

for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && key !== 'admin_accounts') {
backup.data[key] = localStorage.getItem(key);
}
}

const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
const filename = `mytimetable-backup-${new Date().toISOString().split('T')[0]}.json`;
a.download = filename;
a.click();
URL.revokeObjectURL(url);

addLog('Database backup completed by ' + currentAdmin.username);
showModal('Backup Complete', `<p style="color: #00ff88;">‚úÖ Full database backup created!</p><p style="color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 15px;">File: ${filename}<br>Items backed up: ${Object.keys(backup.data).length}</p>`);
}

function clearCache() {
if (confirm('Clear system cache? This will remove temporary data but preserve user information.')) {
const keysToKeep = [];
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && (key.startsWith('notes_') || key.startsWith('custom_timetable_') || key.startsWith('timetable_') || key === 'admin_accounts')) {
keysToKeep.push({ key: key, value: localStorage.getItem(key) });
}
}
const itemsRemoved = localStorage.length - keysToKeep.length;
localStorage.clear();
keysToKeep.forEach(item => localStorage.setItem(item.key, item.value));
addLog(`System cache cleared by ${currentAdmin.username} (${itemsRemoved} items removed)`);
showModal('Cache Cleared', `<p style="color: #00ff88;">‚úÖ System cache cleared successfully!</p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">${itemsRemoved} temporary items removed</p>`);
loadStats();
}
}

function viewLogs() {
const terminal = document.getElementById('terminal').innerHTML;
showModal('System Logs', `<div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 12px; color: #00ff00; max-height: 400px; overflow-y: auto; border: 1px solid rgba(0,255,0,0.3);">${terminal}</div>`);
addLog('Viewed system logs');
}

// System Control
function toggleMaintenance() {
const current = localStorage.getItem('maintenance_mode') === 'true';
localStorage.setItem('maintenance_mode', (!current).toString());
const status = !current ? 'ENABLED' : 'DISABLED';
addLog(`Maintenance mode ${status.toLowerCase()} by ${currentAdmin.username}`);
showModal('Maintenance Mode', `<p style="color: ${!current ? '#ff8c00' : '#00ff88'};">üîß Maintenance mode has been <strong>${status}</strong></p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">Status: ${!current ? 'ACTIVE - Users will see maintenance message' : 'INACTIVE - Normal operation'}</p>`);
}

function forceSync() {
addLog('Force sync initiated by ' + currentAdmin.username);
let synced = 0;
for (let i = 0; i < localStorage.length; i++) {
const key = localStorage.key(i);
if (key && (key.startsWith('notes_') || key.startsWith('custom_timetable_'))) {
synced++;
}
}
setTimeout(() => {
showModal('Sync Complete', `<p style="color: #00ff88;">‚úÖ Data synchronization completed!</p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">${synced} items synchronized<br>Status: All data up to date</p>`);
addLog(`Synchronization complete (${synced} items)`);
}, 1500);
}

function resetDemo() {
if (confirm('Reset demo account? This will clear all demo/guest user data.')) {
localStorage.removeItem('notes_guest');
localStorage.removeItem('custom_timetable_guest');
localStorage.removeItem('timetable_selected_guest');
localStorage.removeItem('timetable_type_guest');
localStorage.removeItem('guest_dark_mode');
localStorage.removeItem('guest_motion_effects');
addLog('Demo account reset by ' + currentAdmin.username);
showModal('Demo Reset', '<p style="color: #00ff88;">‚úÖ Demo account has been reset successfully!</p><p style="color: rgba(255,255,255,0.6); margin-top: 10px;">All guest user data cleared</p>');
loadStats();
}
}

// Terminal
function addLog(message) {
const terminal = document.getElementById('terminal');
const line = document.createElement('div');
line.className = 'terminal-line';
const time = new Date().toLocaleTimeString();
line.innerHTML = `<span class="terminal-prompt">admin@mytimetable:~$</span> [${time}] ${message}`;
terminal.appendChild(line);
terminal.scrollTop = terminal.scrollHeight;
}

// Modal
function showModal(header, body, buttons = null) {
document.getElementById('modalHeader').textContent = header;
document.getElementById('modalBody').innerHTML = body;
const buttonsContainer = document.getElementById('modalButtons');
if (buttons) {
buttonsContainer.innerHTML = '';
buttons.forEach(btn => {
const button = document.createElement('button');
button.className = `modal-btn ${btn.class}`;
button.textContent = btn.text;
button.onclick = btn.action;
buttonsContainer.appendChild(button);
});
} else {
buttonsContainer.innerHTML = '<button class="modal-btn secondary" onclick="closeModal()">Close</button>';
}
document.getElementById('modal').classList.add('active');
}

function closeModal() {
document.getElementById('modal').classList.remove('active');
}

// Logout
function logout() {
if (confirm('Logout from admin panel?')) {
addLog(`Admin logged out: ${currentAdmin.username}`);
setTimeout(() => {
currentAdmin = null;
document.getElementById('adminPanel').classList.remove('active');
document.getElementById('loginScreen').style.display = 'block';
document.getElementById('username').value = '';
document.getElementById('password').value = '';
document.getElementById('adminManagementSection').style.display = 'none';
}, 500);
}
}

// Keyboard support
document.addEventListener('keydown', (e) => {
if (e.key === 'Enter') {
const loginScreen = document.getElementById('loginScreen');
if (loginScreen && loginScreen.style.display !== 'none') {
login();
}
}
if (e.key === 'Escape') {
closeModal();
}
});

// Initialize
window.addEventListener('load', () => {
init();
console.log('%cüîê ADMIN PANEL LOADED', 'color: #ff8c00; font-size: 20px; font-weight: bold;');
console.log('%cDefault Credentials:', 'color: #00ff88; font-size: 14px;');
console.log('%c  ronitmantri / 123456789 (Super Admin)', 'color: white; font-size: 12px;');
console.log('%c  kabir / 12345 (Admin)', 'color: white; font-size: 12px;');
});
</script>
</body>
</html>
